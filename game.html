<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finans Kamp√ºs√º Oyunlarƒ±</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        bg: '#0f172a', surface: '#1e293b', primary: '#38bdf8', accent: '#818cf8', 
                        success: '#34d399', warning: '#fbbf24', danger: '#f87171' 
                    },
                    animation: { 'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    
    <style>
        /* ORTAK STƒ∞LLER */
        body { margin: 0; padding: 0; background-color: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* √úst Navigasyon (Oyun Se√ßici) */
        .game-nav {
            display: flex; justify-content: center; background: #16213e; padding: 10px; border-bottom: 2px solid #f1c40f;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 50; position: relative;
        }
        .nav-btn {
            background: transparent; border: 1px solid #334155; color: #94a3b8;
            padding: 10px 20px; margin: 0 5px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;
            transition: all 0.3s;
        }
        .nav-btn:hover { color: #fff; border-color: #fff; }
        .nav-btn.active { background: #f1c40f; color: #000; border-color: #f1c40f; box-shadow: 0 0 10px rgba(241, 196, 15, 0.4); }

        /* Oyun Konteynerlarƒ± */
        .game-container { display: none; width: 100vw; height: calc(100vh - 60px); overflow-y: auto; background: #0f172a; }
        .game-container.active { display: block; }

        /* LIFESIM √ñZEL STƒ∞LLER */
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        .typing::after { content: '|'; animation: blink 1s step-start infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .hap-bilgi-card { background: linear-gradient(135deg, #059669 0%, #047857 100%); border: 1px solid #34d399; box-shadow: 0 0 15px rgba(52, 211, 153, 0.4); }

        /* Fƒ∞NANS OYUNU STƒ∞LLERƒ∞ */
        .fin-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
        .fin-item { background: #0f3460; padding: 10px; border-radius: 8px; border: 1px solid #333; cursor: pointer; position: relative; }
        .fin-item:hover { border-color: #f1c40f; }
        .fin-item.locked { opacity: 0.5; pointer-events: none; filter: grayscale(1); }
        .fin-btn { width: 100%; background: linear-gradient(45deg, #27ae60, #2ecc71); border: none; padding: 15px; color: white; font-weight: bold; font-size: 16px; cursor: pointer; border-radius: 8px; margin-top: 10px; }
        .fin-clicker { width: 80px; height: 80px; border-radius: 50%; background: #f1c40f; border: 4px solid #fff; font-size: 30px; cursor: pointer; margin: 10px auto; display: block; box-shadow: 0 0 20px rgba(241,196,15,0.5); }
        .fin-clicker:active { transform: scale(0.95); }

        /* MATRIX OYUNU STƒ∞LLERƒ∞ */
        #matrix-canvas { box-shadow: 0 0 30px rgba(0,0,0,0.9); border: 1px solid #222; background: #080808; margin: 10px auto; display: block; }
        .matrix-btn { background: #38bdf8; color: #0f172a; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; display: block; margin: 10px auto; }
        
        /* TRANSFER KODU KUTUSU */
        .code-box { background: #fff; color: #000; padding: 10px; margin: 10px; border-radius: 5px; font-family: monospace; font-weight: bold; text-align: center; display: none; border: 2px dashed #000; }
    </style>
</head>
<body>

    <div class="game-nav">
        <button class="nav-btn active" onclick="switchGame('lifesim', this)">üíº LifeSim</button>
        <button class="nav-btn" onclick="switchGame('finance', this)">üìà Finans ƒ∞mparatoru</button>
        <button class="nav-btn" onclick="switchGame('matrix', this)">üß© Asset Matrix</button>
    </div>

    <div id="lifesim" class="game-container active p-2 md:p-6 flex flex-col md:flex-row gap-6">
        
        <div class="w-full md:w-1/3 flex flex-col gap-4">
            <div class="flex items-center gap-3 mb-1">
                <div class="bg-primary/20 p-2 rounded-lg relative">
                    <div class="absolute top-0 right-0 w-2 h-2 bg-success rounded-full animate-pulse"></div>
                    <i data-lucide="cpu" class="text-primary w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-wider text-white">SOCRATES-AI <span class="text-xs text-primary font-mono px-2 py-0.5 border border-primary rounded ml-2">v4.0</span></h1>
                    <p class="text-xs text-slate-400 font-mono">Maieutics Learning Protocol</p>
                </div>
            </div>

            <div class="glass p-4 rounded-xl border-l-4 border-accent">
                <label class="text-xs text-slate-400 uppercase font-bold flex items-center gap-2"><i data-lucide="database"></i> Sim√ºlasyon Veri Tabanƒ±</label>
                <select id="scenarioSelect" onchange="loadScenario()" class="w-full mt-2 bg-slate-900 text-white p-2 rounded border border-slate-700 outline-none focus:border-accent transition-colors cursor-pointer font-mono text-sm">
                    <option>Veriler Y√ºkleniyor...</option>
                </select>
            </div>

            <div class="glass p-6 rounded-xl flex-1 flex flex-col relative overflow-hidden group">
                <div class="flex justify-between items-start mb-4">
                    <span id="categoryBadge" class="px-3 py-1 bg-blue-500/20 text-blue-400 text-xs font-bold rounded-full font-mono">BEKLENƒ∞YOR</span>
                </div>
                <h2 id="scenarioTitle" class="text-lg font-bold text-white mb-4 leading-snug">...</h2>
                <div class="prose prose-invert text-sm text-slate-300 flex-1 overflow-y-auto pr-2 font-light" id="scenarioText"></div>
                <div class="mt-4 bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                    <h3 class="text-xs font-bold text-slate-400 mb-2 flex items-center gap-2 font-mono"><i data-lucide="binary" class="w-4 h-4"></i> Gƒ∞RDƒ∞ PARAMETRELERƒ∞</h3>
                    <ul id="scenarioData" class="space-y-1 text-xs md:text-sm font-mono text-primary"></ul>
                </div>
            </div>
        </div>

        <div class="w-full md:w-2/3 flex flex-col gap-4">
            <div id="aiInteractionArea" class="glass p-5 rounded-xl border border-slate-700/80 min-h-[140px] flex gap-4 transition-all duration-500">
                <div class="bg-slate-800 p-3 rounded-full shrink-0 h-12 w-12 flex items-center justify-center border border-slate-600">
                    <i data-lucide="bot" class="text-accent w-6 h-6 animate-pulse-fast"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-accent text-xs font-bold mb-1 uppercase tracking-widest font-mono flex justify-between">
                        <span>Sƒ∞STEM DURUMU: <span id="systemState" class="text-white">BEKLEMEDE</span></span>
                        <span id="scoreDisplay" class="text-white hidden">Analiz Skoru: %0</span>
                    </h4>
                    <div id="aiFeedback" class="text-sm text-slate-200 leading-relaxed font-mono mt-2">
                        <span class="typing">Sisteme ho≈ü geldin. Bir senaryo se√ß ve analizi ba≈ülat.</span>
                    </div>
                    <div id="hapBilgiBox" class="hidden mt-4 p-4 rounded-lg hap-bilgi-card transform transition-all duration-500 hover:scale-[1.01]">
                        <div class="flex items-center gap-2 mb-2 text-white font-bold border-b border-white/20 pb-1">
                            <i data-lucide="gem" class="w-4 h-4"></i><span>KRƒ∞Tƒ∞K HAP Bƒ∞LGƒ∞</span>
                        </div>
                        <p id="hapBilgiText" class="text-xs md:text-sm text-white font-semibold italic"></p>
                    </div>
                </div>
            </div>

            <div class="glass p-1 rounded-xl flex-1 relative min-h-[300px] border border-slate-700 glow-border flex flex-col">
                <textarea id="inputText" class="w-full h-full bg-transparent p-6 text-base text-slate-200 resize-none outline-none font-light leading-relaxed font-mono" placeholder="// √á√∂z√ºm algoritmanƒ± buraya yaz..."></textarea>
                <div class="absolute bottom-4 right-4 flex gap-2">
                    <button onclick="analyzeSubmission()" id="actionBtn" class="bg-primary hover:bg-blue-400 text-slate-900 font-bold px-6 py-2 rounded-lg shadow-lg shadow-primary/20 flex items-center gap-2 transition-all active:scale-95 group">
                        <i data-lucide="zap" class="w-4 h-4 group-hover:fill-current"></i> ANALƒ∞Zƒ∞ BA≈ûLAT
                    </button>
                </div>
            </div>
            
            <div id="lifeSimCodeBox" class="code-box"></div>
        </div>
    </div>

    <div id="finance" class="game-container">
        <div style="max-width: 600px; margin: 0 auto; padding: 10px; text-align: center;">
            <div style="background:#16213e; padding:10px; border-radius:10px; border:1px solid #f1c40f; display:flex; justify-content:space-between;">
                <div style="font-size:20px; color:#f1c40f; font-weight:bold;">KASA: <span id="finMoney">0</span> ‚Ç∫</div>
                <div style="font-size:12px; color:#2ecc71;">GELƒ∞R: <span id="finCps">0</span>/sn</div>
            </div>
            <button class="fin-clicker" onclick="clickCoin()">üëÜ</button>
            <div class="fin-grid" id="market"></div>
            <button class="fin-btn" onclick="generateCode('fin')">üè¶ BANKA TRANSFER KODU AL</button>
            <div id="finCodeArea" class="code-box"></div>
        </div>
    </div>

    <div id="matrix" class="game-container">
        <div style="text-align: center;">
            <div style="margin-bottom: 10px; color: #aaa;">SKOR: <span id="matScore" style="color:#fff; font-weight:bold; font-size:24px;">0</span></div>
            <canvas id="matrix-canvas"></canvas>
            <button class="matrix-btn" onclick="initMatrix()">YENƒ∞ OYUN</button>
            <button class="fin-btn" style="background:linear-gradient(45deg, #38bdf8, #2980b9); max-width:300px; margin:10px auto;" onclick="generateCode('mat')">üíé PUANLARI KODA √áEVƒ∞R</button>
            <div id="matCodeArea" class="code-box"></div>
        </div>
    </div>

    <script>
        // --- NAVƒ∞GASYON ---
        function switchGame(gameId, btn) {
            document.querySelectorAll('.game-container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(gameId).classList.add('active');
            btn.classList.add('active');
            if(gameId === 'matrix') setTimeout(resizeMatrix, 100);
        }

        // --- ORTAK KOD √úRETME ---
        function generateCode(type, value = 0) {
            let val = value;
            let areaId = "";
            
            if(type === 'fin') {
                if(finMoney < 10) return alert("En az 10 TL birikmeli!");
                val = Math.floor(finMoney); finMoney = 0; assets.forEach(a => a.cnt = 0); updateFinUI();
                areaId = 'finCodeArea';
            } else if (type === 'mat') {
                if(matScore < 5) return alert("En az 5 Puan!");
                val = matScore; matScore = 0; initMatrix();
                areaId = 'matCodeArea';
            } else if (type === 'life') {
                // LifeSim'den gelen
                areaId = 'lifeSimCodeBox';
            }

            let hex = (val * 13).toString(16).toUpperCase();
            let rnd = Math.floor(Math.random() * 99);
            let code = `FNK-${hex}-${rnd}`;
            
            let el = document.getElementById(areaId);
            el.innerText = "TRANSFER KODUNUZ: " + code;
            el.style.display = 'block';
        }

        // ================= LIFESIM MANTIƒûI (Senin Kodlarƒ±n Entegre Edildi) =================
        let scenarios = [];
        // PYTHON_DATA_HERE (App.py burayƒ± JSON ile dolduracak)
        
        // Demo Veri (Eƒüer Python √ßalƒ±≈ümazsa)
        if(scenarios.length === 0) {
             scenarios = [
                { category: "Demo", title: "Veri Bekleniyor", text: "Python baƒülantƒ±sƒ± yok.", data: [], keywords: {}, hapBilgi: "" }
             ];
        }

        let currentScenario = null;
        let conversationPhase = 0;

        function loadScenarioDropdown() {
            const select = document.getElementById('scenarioSelect');
            select.innerHTML = "";
            scenarios.forEach((s, idx) => {
                let opt = document.createElement('option');
                opt.value = idx;
                opt.innerText = `[${s.category}] ${s.title}`;
                select.appendChild(opt);
            });
        }

        function loadScenario(index = null) {
            if(index === null) index = document.getElementById('scenarioSelect').value;
            currentScenario = scenarios[index];
            document.getElementById('categoryBadge').innerText = currentScenario.category;
            document.getElementById('scenarioTitle').innerText = currentScenario.title;
            document.getElementById('scenarioText').innerText = currentScenario.text;
            
            const dataList = document.getElementById('scenarioData');
            dataList.innerHTML = "";
            currentScenario.data.forEach(item => {
                dataList.innerHTML += `<li class="border-b border-slate-700/50 pb-1 text-accent">> ${item}</li>`;
            });

            document.getElementById('inputText').value = "";
            document.getElementById('aiFeedback').innerHTML = `<span class="typing text-primary">Analiz bekleniyor...</span>`;
            document.getElementById('hapBilgiBox').classList.add('hidden');
            document.getElementById('lifeSimCodeBox').style.display = 'none';
            
            const btn = document.getElementById('actionBtn');
            btn.innerHTML = 'ANALƒ∞Zƒ∞ BA≈ûLAT'; btn.disabled = false; btn.classList.remove('bg-success');
            conversationPhase = 0;
            lucide.createIcons();
        }

        function analyzeSubmission() {
            const text = document.getElementById('inputText').value.toLowerCase();
            const feedbackArea = document.getElementById('aiFeedback');
            const btn = document.getElementById('actionBtn');

            if (text.length < 10) { feedbackArea.innerHTML = "√áok kƒ±sa. Detaylandƒ±r."; return; }

            btn.innerHTML = 'ƒ∞≈ûLENƒ∞YOR...'; btn.disabled = true;

            setTimeout(() => {
                let score = 0;
                let missing = [];
                const keys = currentScenario.keywords || {};
                const totalKeys = Object.keys(keys).length;

                for (const [key, q] of Object.entries(keys)) {
                    if (text.includes(key)) score++; else missing.push(q);
                }
                
                // Ba≈üarƒ± Kriteri: %50
                const success = totalKeys === 0 || (score / totalKeys) >= 0.5;

                if (success) {
                    const reward = currentScenario.money_reward || 1000;
                    feedbackArea.innerHTML = `<span class="text-success font-bold">BA≈ûARILI!</span><br>${currentScenario.hapBilgi}`;
                    document.getElementById('hapBilgiText').innerText = currentScenario.hapBilgi;
                    document.getElementById('hapBilgiBox').classList.remove('hidden');
                    
                    btn.innerHTML = 'TAMAMLANDI';
                    btn.className = "bg-success text-slate-900 font-bold px-6 py-2 rounded-lg cursor-default";
                    
                    // KOD √úRET
                    generateCode('life', reward);
                    
                } else {
                    const hint = missing.length > 0 ? missing[0] : "Daha detaylƒ± a√ßƒ±kla.";
                    feedbackArea.innerHTML = `<span class="text-warning">EKSƒ∞K VAR:</span><br>${hint}`;
                    btn.innerHTML = 'TEKRAR DENE'; btn.disabled = false;
                }
            }, 1000);
        }

        // ================= Fƒ∞NANS OYUNU JS =================
        let finMoney = 0;
        let assets = [
            {n: "Limonata", c: 50, i: 0.5, cnt: 0}, {n: "Simit√ßi", c: 350, i: 2, cnt: 0},
            {n: "Kƒ±rtasiye", c: 1500, i: 8, cnt: 0}, {n: "Kantin", c: 7500, i: 35, cnt: 0},
            {n: "Servis Aƒüƒ±", c: 35000, i: 150, cnt: 0}
        ];

        function updateFinUI() {
            document.getElementById('finMoney').innerText = Math.floor(finMoney).toLocaleString();
            let cps = assets.reduce((t, a) => t + (a.cnt * a.i), 0);
            document.getElementById('finCps').innerText = cps.toFixed(1);
            
            let m = document.getElementById('market');
            m.innerHTML = "";
            assets.forEach((a, i) => {
                let cost = Math.floor(a.c * Math.pow(1.25, a.cnt));
                let div = document.createElement('div');
                div.className = "fin-item " + (finMoney >= cost ? "" : "locked");
                div.onclick = () => buyAsset(i);
                div.innerHTML = `<div style="font-weight:bold; color:white;">${a.n} <span style="background:#f1c40f; color:black; border-radius:50%; padding:2px 6px; font-size:10px;">${a.cnt}</span></div><div style="color:#e74c3c; font-size:11px;">${cost.toLocaleString()} ‚Ç∫</div><div style="color:#2ecc71; font-size:11px;">+${a.i}/sn</div>`;
                m.appendChild(div);
            });
        }
        function clickCoin() { finMoney += 1; updateFinUI(); }
        function buyAsset(i) {
            let a = assets[i]; let cost = Math.floor(a.c * Math.pow(1.25, a.cnt));
            if(finMoney >= cost) { finMoney -= cost; a.cnt++; updateFinUI(); }
        }
        setInterval(() => {
            let inc = assets.reduce((t, a) => t + (a.cnt * a.i), 0);
            if(inc > 0) { finMoney += inc / 10; updateFinUI(); }
        }, 100);
        updateFinUI();

        // ================= MATRIX OYUNU JS =================
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        const GRID = 10; let CELL = 30;
        let grid = [], pieces = [], dragging = null, matScore = 0;

        function resizeMatrix() {
            const container = document.getElementById('matrix');
            const width = Math.min(window.innerWidth - 40, 400); 
            CELL = Math.floor(width / (GRID + 2));
            canvas.width = CELL * GRID + 20; canvas.height = CELL * GRID + 140;
            if(pieces.length > 0) drawMatrix();
        }

        const SHAPES = [[[1]], [[1,1]], [[1],[1]], [[1,1],[1,1]], [[1,1,1]], [[1],[1],[1]]];

        function initMatrix() {
            grid = Array(GRID).fill(0).map(()=>Array(GRID).fill(0));
            matScore = 0; spawnPieces(); drawMatrix();
        }
        function spawnPieces() {
            pieces = [];
            for(let i=0; i<3; i++) {
                const m = SHAPES[Math.floor(Math.random()*SHAPES.length)];
                const w = m[0].length * CELL;
                const x = 10 + i * (canvas.width/3) + (canvas.width/3 - w)/2;
                const y = CELL * GRID + 30;
                pieces.push({ m, x, y, bx: x, by: y, w, h: m.length*CELL });
            }
        }
        function drawMatrix() {
            ctx.fillStyle = "#080808"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.strokeStyle = "#333"; ctx.lineWidth=1; ctx.beginPath();
            for(let i=0; i<=GRID; i++) {
                ctx.moveTo(10, 10+i*CELL); ctx.lineTo(10+GRID*CELL, 10+i*CELL);
                ctx.moveTo(10+i*CELL, 10); ctx.lineTo(10+i*CELL, 10+GRID*CELL);
            }
            ctx.stroke();
            for(let r=0; r<GRID; r++) for(let c=0; c<GRID; c++) 
                if(grid[r][c]) { ctx.fillStyle="#38bdf8"; ctx.fillRect(10+c*CELL+1, 10+r*CELL+1, CELL-2, CELL-2); }
            pieces.forEach(p => {
                ctx.fillStyle = p===dragging ? "rgba(241, 196, 15, 0.8)" : "#f1c40f";
                p.m.forEach((row, r) => row.forEach((val, c) => {
                    if(val) ctx.fillRect(p.x + c*CELL, p.y + r*CELL, CELL-2, CELL-2);
                }));
            });
            document.getElementById('matScore').innerText = matScore;
        }
        // Matrix Eventleri
        function getPos(e) {
            const r = canvas.getBoundingClientRect();
            const x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
            return { x: (x-r.left)*(canvas.width/r.width), y: (y-r.top)*(canvas.height/r.height) };
        }
        function mStart(e) {
            e.preventDefault(); const p_ = getPos(e);
            for(let i=pieces.length-1; i>=0; i--) {
                const p = pieces[i];
                if(p_.x>=p.x && p_.x<=p.x+p.w && p_.y>=p.y && p_.y<=p.y+p.h) {
                    dragging=p; dragging.dx=p_.x-p.x; dragging.dy=p_.y-p.y; drawMatrix(); return;
                }
            }
        }
        function mMove(e) {
            if(!dragging) return; e.preventDefault(); const p=getPos(e);
            dragging.x=p.x-dragging.dx; dragging.y=p.y-dragging.dy; drawMatrix();
        }
        function mEnd(e) {
            if(!dragging) return; e.preventDefault();
            const gx=Math.round((dragging.x-10)/CELL); const gy=Math.round((dragging.y-10)/CELL);
            if(canPlace(dragging.m, gx, gy)) {
                place(dragging.m, gx, gy); pieces=pieces.filter(p=>p!==dragging);
                if(pieces.length===0) spawnPieces();
            } else { dragging.x=dragging.bx; dragging.y=dragging.by; }
            dragging=null; drawMatrix();
        }
        function canPlace(m, gx, gy) {
            return m.every((row, r) => row.every((val, c) => {
                if(!val) return true;
                const tx=gx+c, ty=gy+r;
                return tx>=0 && tx<GRID && ty>=0 && ty<GRID && !grid[ty][tx];
            }));
        }
        function place(m, gx, gy) {
            m.forEach((row, r) => row.forEach((val, c) => { if(val) grid[gy+r][gx+c]=1; }));
            matScore+=10; 
            let rows=[], cols=[];
            for(let r=0; r<GRID; r++) if(grid[r].every(v=>v)) rows.push(r);
            for(let c=0; c<GRID; c++) if(grid.map(r=>r[c]).every(v=>v)) cols.push(c);
            if(rows.length+cols.length>0) {
                rows.forEach(r=>grid[r].fill(0)); cols.forEach(c=>grid.forEach(r=>r[c]=0));
                matScore+=(rows.length+cols.length)*50;
            }
        }
        canvas.addEventListener('mousedown', mStart); canvas.addEventListener('touchstart', mStart, {passive:false});
        canvas.addEventListener('mousemove', mMove); canvas.addEventListener('touchmove', mMove, {passive:false});
        canvas.addEventListener('mouseup', mEnd); canvas.addEventListener('touchend', mEnd, {passive:false});

        // --- BA≈ûLAT ---
        window.onload = function() {
            lucide.createIcons();
            loadScenarioDropdown();
            loadScenario(0);
            initMatrix();
            updateFinUI();
            window.addEventListener('resize', resizeMatrix);
        };
    </script>
</body>
</html>
