<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finans Ä°mparatoru</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        bg: '#0f172a', surface: '#1e293b', primary: '#38bdf8', 
                        accent: '#818cf8', success: '#34d399', warning: '#fbbf24', danger: '#f87171' 
                    },
                    fontFamily: { sans: ['Montserrat', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #fff; overflow: hidden; }
        
        /* Sidebar Stilleri */
        .sidebar { width: 250px; background: #0f172a; border-right: 1px solid #334155; display: flex; flex-direction: column; height: 100vh; position: fixed; left: 0; top: 0; z-index: 50; transition: transform 0.3s; }
        .menu-item { display: flex; items-center; gap: 10px; padding: 12px 20px; color: #94a3b8; cursor: pointer; transition: 0.2s; font-weight: 600; font-size: 0.9rem; }
        .menu-item:hover { background: #1e293b; color: #fff; }
        .menu-item.active { background: #38bdf8; color: #0f172a; border-right: 4px solid #fff; }
        .menu-icon { width: 20px; height: 20px; }

        /* Ana Ä°Ã§erik AlanÄ± */
        .main-content { margin-left: 250px; height: 100vh; overflow-y: auto; background: #050505; padding: 20px; position: relative; }
        .section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobil Uyumluluk */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); width: 100%; max-width: 280px; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding-top: 60px; }
            #mobile-menu-btn { display: block; }
        }

        /* Ã–zel BileÅŸenler */
        .glass-card { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; }
        .game-canvas { border: 1px solid #333; background: #080808; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.8); margin: 0 auto; display: block; }
        
        /* Alt Sekmeler (EÄŸlence MenÃ¼sÃ¼ Ä°Ã§in) */
        .sub-tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .sub-tab { padding: 8px 16px; border-radius: 6px; cursor: pointer; color: #94a3b8; font-size: 0.85rem; font-weight: bold; }
        .sub-tab.active { background: #334155; color: #fff; }
    </style>
</head>
<body>

    <button id="mobile-menu-btn" onclick="toggleSidebar()" class="fixed top-4 left-4 z-50 p-2 bg-slate-800 rounded text-white md:hidden hidden">
        <i data-lucide="menu"></i>
    </button>

    <div class="sidebar" id="sidebar">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-black text-white tracking-tighter">FINANS <span class="text-primary">Ä°MPARATORU</span></h1>
            <div class="text-xs text-slate-500 mt-1">v2.1 Beta</div>
        </div>
        
        <nav class="flex-1 py-4 overflow-y-auto">
            <div class="menu-item" onclick="showSection('profil')">
                <i data-lucide="user" class="menu-icon"></i> Profil
            </div>
            <div class="menu-item active" onclick="showSection('soru-cozum')">
                <i data-lucide="brain-circuit" class="menu-icon"></i> Soru Ã‡Ã¶zÃ¼m Merkezi
            </div>
            <div class="menu-item" onclick="showSection('lifesim')">
                <i data-lucide="briefcase" class="menu-icon"></i> LifeSim (Kariyer)
            </div>
            <div class="menu-item" onclick="showSection('eglence')">
                <i data-lucide="gamepad-2" class="menu-icon"></i> EÄŸlence & Finans
            </div>
            <div class="menu-item" onclick="showSection('premium')">
                <i data-lucide="crown" class="menu-icon text-yellow-500"></i> Premium
            </div>
            <div class="menu-item" onclick="showSection('skor')">
                <i data-lucide="trophy" class="menu-icon"></i> Skor Tablosu
            </div>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="bg-slate-900 rounded-lg p-3">
                <div class="text-xs text-slate-400">Toplam VarlÄ±k</div>
                <div class="text-lg font-bold text-success" id="sidebar-cash">0 TL</div>
            </div>
        </div>
    </div>

    <div class="main-content" onclick="closeSidebarMobile()">
        
        <div id="profil" class="section">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="user" class="text-primary"></i> Oyuncu Profili</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-card p-6 flex items-center gap-4">
                    <div class="w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center text-2xl">ðŸ‘¤</div>
                    <div>
                        <div class="text-sm text-slate-400">KullanÄ±cÄ± AdÄ±</div>
                        <div class="text-xl font-bold">YatÄ±rÄ±mcÄ± AdayÄ±</div>
                        <div class="text-xs text-primary bg-primary/10 px-2 py-0.5 rounded mt-1 inline-block">BaÅŸlangÄ±Ã§ Seviyesi</div>
                    </div>
                </div>
                <div class="glass-card p-6">
                    <h3 class="text-sm font-bold text-slate-400 mb-2">Ä°statistikler</h3>
                    <div class="flex justify-between border-b border-slate-700 py-2">
                        <span>Ã‡Ã¶zÃ¼len Senaryo</span> <span class="text-white font-mono">0</span>
                    </div>
                    <div class="flex justify-between py-2">
                        <span>BaÅŸarÄ± OranÄ±</span> <span class="text-white font-mono">%0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="soru-cozum" class="section active">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="brain-circuit" class="text-primary"></i> Soru Ã‡Ã¶zÃ¼m Merkezi</h2>
            <div class="flex flex-col md:flex-row gap-6 h-[80vh]">
                <div class="w-full md:w-1/3 flex flex-col gap-4">
                    <div class="glass-card p-4 border-l-4 border-accent">
                        <label class="text-xs text-slate-400 font-bold uppercase mb-2 block">GÃ–REV / SENARYO SEÃ‡</label>
                        <select id="scenarioSelect" onchange="loadScenario()" class="w-full bg-slate-900 text-white p-3 rounded border border-slate-700 focus:border-accent outline-none">
                            <option>YÃ¼kleniyor...</option>
                        </select>
                    </div>
                    <div class="glass-card p-5 flex-1 flex flex-col">
                        <span id="categoryBadge" class="self-start px-2 py-1 bg-slate-700 text-xs rounded mb-3 text-slate-300">KATEGORÄ°</span>
                        <h3 id="scenarioTitle" class="text-lg font-bold text-white mb-3">Senaryo BaÅŸlÄ±ÄŸÄ±</h3>
                        <p id="scenarioText" class="text-sm text-slate-300 font-light leading-relaxed mb-4">Ä°Ã§erik bekleniyor...</p>
                        <div class="mt-auto pt-4 border-t border-slate-700/50 flex justify-between items-center">
                            <span class="text-xs text-slate-400">Potansiyel KazanÃ§:</span>
                            <span id="rewardBadge" class="text-success font-bold">+1000 TL</span>
                        </div>
                    </div>
                </div>
                <div class="w-full md:w-2/3 flex flex-col gap-4">
                    <div class="glass-card p-4 min-h-[100px] flex gap-3 items-start">
                        <i data-lucide="bot" class="text-accent shrink-0 mt-1"></i>
                        <div id="aiFeedback" class="text-sm text-slate-200 leading-relaxed">Analiz sistemi hazÄ±r. CevabÄ±nÄ±zÄ± bekliyorum...</div>
                    </div>
                    <div class="glass-card p-1 flex-1 relative flex flex-col">
                        <textarea id="inputText" class="w-full h-full bg-transparent p-5 text-slate-200 resize-none outline-none font-mono text-sm" placeholder="// Ã‡Ã¶zÃ¼m stratejinizi buraya yazÄ±n..."></textarea>
                        <div class="absolute bottom-4 right-4">
                            <button onclick="analyzeSubmission()" id="actionBtn" class="bg-primary hover:bg-blue-400 text-slate-900 font-bold px-5 py-2 rounded shadow-lg transition-transform active:scale-95 flex items-center gap-2">
                                <i data-lucide="zap" size="16"></i> ANALÄ°Z ET
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="lifesim" class="section">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="briefcase" class="text-primary"></i> LifeSim Kariyer YÃ¶netimi</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-card p-6 border-t-4 border-success">
                    <h3 class="text-lg font-bold text-white mb-1">VarlÄ±klarÄ±m</h3>
                    <p class="text-xs text-slate-400 mb-4">Nakit ve Banka ToplamÄ±</p>
                    <div class="text-3xl font-black text-success tracking-tight" id="total-assets">0 TL</div>
                    <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-slate-500">CÃ¼zdan</div>
                            <div id="wallet-val" class="text-white font-mono">0</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-slate-500">Banka</div>
                            <div id="bank-val" class="text-white font-mono">0</div>
                        </div>
                    </div>
                </div>
                <div class="glass-card p-6 border-t-4 border-primary">
                    <h3 class="text-lg font-bold text-white mb-1">Mevcut Ä°ÅŸ</h3>
                    <div class="flex items-center gap-3 mt-4">
                        <div class="w-10 h-10 bg-primary/20 rounded flex items-center justify-center text-primary"><i data-lucide="building-2"></i></div>
                        <div>
                            <div class="font-bold">Serbest YatÄ±rÄ±mcÄ±</div>
                            <div class="text-xs text-slate-400">GiriÅŸ Seviyesi</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="eglence" class="section">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="gamepad-2" class="text-primary"></i> EÄŸlence & KazanÃ§</h2>
            
            <div class="sub-tabs">
                <div class="sub-tab active" onclick="showSubTab('blok-oyunu', this)">ðŸ§© Blok Oyunu</div>
                <div class="sub-tab" onclick="showSubTab('finans-oyunu', this)">ðŸ“ˆ Pasif Gelir (Finans)</div>
            </div>

            <div id="blok-oyunu" class="sub-section active">
                <div class="flex flex-col items-center">
                    <div class="w-full max-w-[500px] flex justify-between items-end mb-2 px-2">
                        <div class="text-white font-bold text-xl"><span id="score">$0</span> <span class="text-xs text-slate-500 font-normal">Oyun DeÄŸeri</span></div>
                        <div class="text-xs text-yellow-500">SEVÄ°YE 1</div>
                    </div>
                    <canvas id="gameCanvas" class="game-canvas"></canvas>
                    <div class="mt-4 text-center text-xs text-slate-500">
                        BloklarÄ± yerleÅŸtir, satÄ±rlarÄ± sil, para kazan. KazancÄ±n cÃ¼zdanÄ±na eklenir.
                        <br><button onclick="initGame()" class="mt-2 bg-slate-800 hover:bg-slate-700 text-white px-4 py-1 rounded text-xs border border-slate-600">Oyunu SÄ±fÄ±rla</button>
                    </div>
                </div>
            </div>

            <div id="finans-oyunu" class="sub-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-white mb-4">ðŸ’° Banka & Faiz</h3>
                        <p class="text-sm text-slate-400 mb-4">ParanÄ± bankaya yatÄ±rarak pasif gelir elde et. Faiz her iÅŸlemde iÅŸler.</p>
                        
                        <div class="bg-slate-900 p-4 rounded mb-4 border border-slate-700">
                            <label class="text-xs text-slate-500 block mb-1">YatÄ±rÄ±lacak Miktar</label>
                            <input type="number" id="deposit-amount" class="w-full bg-slate-800 text-white p-2 rounded outline-none border border-slate-600" placeholder="Miktar...">
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="bankAction('deposit')" class="flex-1 bg-success text-slate-900 font-bold py-2 rounded hover:bg-green-400">YATIR</button>
                            <button onclick="bankAction('withdraw')" class="flex-1 bg-slate-700 text-white font-bold py-2 rounded hover:bg-slate-600">Ã‡EK</button>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6 flex flex-col justify-center items-center text-center">
                        <div class="w-20 h-20 bg-yellow-500/10 rounded-full flex items-center justify-center mb-4">
                            <i data-lucide="trending-up" class="text-yellow-500 w-10 h-10"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white">Pasif Gelir Modu</h3>
                        <p class="text-sm text-slate-400 mt-2">Banka bakiyen Ã¼zerinden saatlik faiz kazan.</p>
                        <div class="mt-4 text-2xl font-mono text-yellow-400">%5 Faiz OranÄ±</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="premium" class="section">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="crown" class="text-yellow-500"></i> Premium Ãœyelik</h2>
            <div class="glass-card p-8 text-center max-w-lg mx-auto border border-yellow-500/30">
                <div class="w-24 h-24 bg-gradient-to-br from-yellow-400 to-orange-600 rounded-full mx-auto flex items-center justify-center mb-6 shadow-lg shadow-yellow-500/20">
                    <i data-lucide="star" class="text-white w-12 h-12"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">Pro YatÄ±rÄ±mcÄ± Ol</h3>
                <p class="text-slate-400 mb-6">ReklamsÄ±z deneyim, 2x pasif gelir ve Ã¶zel senaryolara eriÅŸim kazan.</p>
                <button class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded-lg transition-transform active:scale-95">
                    HEMEN YÃœKSELT (Demo)
                </button>
            </div>
        </div>

        <div id="skor" class="section">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="trophy" class="text-primary"></i> Skor Tablosu</h2>
            <div class="glass-card overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-800 text-xs text-slate-400 uppercase">
                        <tr>
                            <th class="p-4">#</th>
                            <th class="p-4">Oyuncu</th>
                            <th class="p-4 text-right">Net VarlÄ±k</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700 text-sm">
                        <tr class="hover:bg-slate-800/50">
                            <td class="p-4 font-mono text-yellow-500">1</td>
                            <td class="p-4 font-bold">Elon M.</td>
                            <td class="p-4 text-right font-mono text-success">â‚º999,000,000</td>
                        </tr>
                        <tr class="hover:bg-slate-800/50">
                            <td class="p-4 font-mono text-slate-400">2</td>
                            <td class="p-4">Jeff B.</td>
                            <td class="p-4 text-right font-mono text-success">â‚º500,000,000</td>
                        </tr>
                        <tr class="bg-primary/10 border-l-4 border-primary">
                            <td class="p-4 font-mono text-white">3</td>
                            <td class="p-4 font-bold text-primary">SÄ°Z</td>
                            <td class="p-4 text-right font-mono text-success" id="leaderboard-score">0 TL</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // --- DEÄžÄ°ÅžKENLER ---
        let playerCash = 0;
        let playerBank = 0;
        let scenarios = [];
        let currentScenario = null;
        
        // --- VERÄ° ENJEKSÄ°YONU (APP.PY Ä°Ã‡Ä°N) ---
        // PYTHON_DATA_HERE
        
        if (typeof scenarios === 'undefined' || scenarios.length === 0) {
            scenarios = [{ "category": "Demo", "title": "Veri Yok", "text": "App.py Ã§alÄ±ÅŸmÄ±yor.", "money_reward": 0 }];
        }

        // --- SAYFA YÃ–NETÄ°MÄ° ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active'); // TÄ±klanan menÃ¼yÃ¼ aktif yap
            
            if(window.innerWidth < 768) toggleSidebar(); // Mobilde menÃ¼yÃ¼ kapat
            
            if(id === 'eglence') {
                setTimeout(resizeBlockGame, 100); // Canvas render sorunu iÃ§in
            }
        }

        function showSubTab(id, btn) {
            document.getElementById('blok-oyunu').classList.add('hidden');
            document.getElementById('finans-oyunu').classList.add('hidden');
            document.getElementById(id).classList.remove('hidden');
            
            document.querySelectorAll('.sub-tab').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            if(id === 'blok-oyunu') setTimeout(resizeBlockGame, 50);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        function closeSidebarMobile() {
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
        }

        // --- EKONOMÄ° ---
        function updateEconomy() {
            const total = playerCash + playerBank;
            const fmt = (num) => num.toLocaleString('tr-TR') + ' TL';
            
            document.getElementById('sidebar-cash').innerText = fmt(total);
            document.getElementById('total-assets').innerText = fmt(total);
            document.getElementById('wallet-val').innerText = fmt(playerCash);
            document.getElementById('bank-val').innerText = fmt(playerBank);
            document.getElementById('leaderboard-score').innerText = fmt(total);
        }

        function bankAction(type) {
            const amount = parseInt(document.getElementById('deposit-amount').value);
            if(!amount || amount <= 0) return alert("GeÃ§ersiz miktar");
            
            if(type === 'deposit') {
                if(amount > playerCash) return alert("Yetersiz Nakit");
                playerCash -= amount; playerBank += amount;
                alert(`${amount} TL yatÄ±rÄ±ldÄ±. Pasif gelir aktif.`);
            } else {
                if(amount > playerBank) return alert("Yetersiz Banka Bakiyesi");
                playerBank -= amount; playerCash += amount;
                alert(`${amount} TL Ã§ekildi.`);
            }
            updateEconomy();
            document.getElementById('deposit-amount').value = '';
        }

        // --- SORU Ã‡Ã–ZÃœM ---
        function loadScenarios() {
            const select = document.getElementById('scenarioSelect');
            select.innerHTML = "";
            scenarios.forEach((s, i) => {
                let opt = document.createElement('option');
                opt.value = i; opt.innerText = s.title;
                select.appendChild(opt);
            });
            loadScenario(0);
        }

        function loadScenario(idx = null) {
            if(idx === null) idx = document.getElementById('scenarioSelect').value;
            currentScenario = scenarios[idx];
            document.getElementById('categoryBadge').innerText = currentScenario.category;
            document.getElementById('scenarioTitle').innerText = currentScenario.title;
            document.getElementById('scenarioText').innerText = currentScenario.text;
            document.getElementById('rewardBadge').innerText = "+" + (currentScenario.money_reward || 1000) + " TL";
            document.getElementById('inputText').value = "";
            document.getElementById('aiFeedback').innerText = "Cevap bekleniyor...";
            const btn = document.getElementById('actionBtn');
            btn.disabled = false; btn.innerHTML = "ANALÄ°Z ET"; btn.classList.remove('bg-success');
        }

        function analyzeSubmission() {
            const txt = document.getElementById('inputText').value.toLowerCase();
            const btn = document.getElementById('actionBtn');
            
            if(txt.length < 3) return alert("Daha uzun yazmalÄ±sÄ±n.");
            
            btn.innerHTML = "Ä°nceleniyor...";
            btn.disabled = true;
            
            setTimeout(() => {
                let score = 0;
                const keys = currentScenario.keywords || {};
                const total = Object.keys(keys).length;
                
                for(let k in keys) if(txt.includes(k)) score++;
                
                const success = total === 0 || (score/total) >= 0.5;
                
                if(success) {
                    const r = currentScenario.money_reward || 1000;
                    playerCash += r;
                    updateEconomy();
                    document.getElementById('aiFeedback').innerHTML = `<span class="text-success font-bold">BAÅžARILI!</span><br>${currentScenario.hapBilgi}`;
                    btn.innerHTML = "TAMAMLANDI";
                    btn.classList.add('bg-success');
                } else {
                    document.getElementById('aiFeedback').innerText = "Eksiklerin var, tekrar dene.";
                    btn.innerHTML = "TEKRAR DENE";
                    btn.disabled = false;
                }
            }, 800);
        }

        // --- BLOK OYUNU ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const GRID_SIZE = 12;
        let CELL_SIZE = 30;
        let grid = [], pieces = [], dragging = null, blockScore = 0;

        function resizeBlockGame() {
            // Container geniÅŸliÄŸine gÃ¶re canvas boyutunu ayarla
            const container = document.getElementById('blok-oyunu');
            const size = Math.min(container.clientWidth - 40, 400); 
            CELL_SIZE = Math.floor(size / GRID_SIZE);
            canvas.width = CELL_SIZE * GRID_SIZE + 20;
            canvas.height = CELL_SIZE * GRID_SIZE + 120; // Spawn alanÄ± iÃ§in yer
            if(pieces.length > 0) draw();
        }

        function initGame() {
            grid = Array(GRID_SIZE).fill(0).map(()=>Array(GRID_SIZE).fill(0));
            blockScore = 0;
            spawnPieces();
            draw();
        }

        const SHAPES = [[[1]], [[1,1]], [[1],[1]], [[1,1],[1,1]], [[1,1,1]], [[1],[1],[1]]];
        
        function spawnPieces() {
            pieces = [];
            for(let i=0; i<3; i++) {
                const m = SHAPES[Math.floor(Math.random()*SHAPES.length)];
                const w = m[0].length * CELL_SIZE;
                const x = 10 + i * (canvas.width/3) + (canvas.width/3 - w)/2;
                const y = CELL_SIZE * GRID_SIZE + 30;
                pieces.push({ m, x, y, bx: x, by: y, w, h: m.length*CELL_SIZE });
            }
        }

        function draw() {
            ctx.fillStyle = "#080808"; ctx.fillRect(0,0,canvas.width,canvas.height);
            // Grid
            ctx.strokeStyle = "#222"; ctx.lineWidth = 1; ctx.beginPath();
            for(let i=0; i<=GRID_SIZE; i++) {
                ctx.moveTo(10, 10+i*CELL_SIZE); ctx.lineTo(10+GRID_SIZE*CELL_SIZE, 10+i*CELL_SIZE);
                ctx.moveTo(10+i*CELL_SIZE, 10); ctx.lineTo(10+i*CELL_SIZE, 10+GRID_SIZE*CELL_SIZE);
            }
            ctx.stroke();
            // YerleÅŸenler
            for(let r=0; r<GRID_SIZE; r++) for(let c=0; c<GRID_SIZE; c++) 
                if(grid[r][c]) { ctx.fillStyle = "#FFD700"; ctx.fillRect(10+c*CELL_SIZE+1, 10+r*CELL_SIZE+1, CELL_SIZE-2, CELL_SIZE-2); }
            // ParÃ§alar
            pieces.forEach(p => drawPiece(p));
            if(dragging) drawPiece(dragging, true);
        }

        function drawPiece(p, glow=false) {
            ctx.fillStyle = glow ? "rgba(56, 189, 248, 0.8)" : "#38bdf8";
            p.m.forEach((row, r) => row.forEach((val, c) => {
                if(val) ctx.fillRect(p.x + c*CELL_SIZE, p.y + r*CELL_SIZE, CELL_SIZE-2, CELL_SIZE-2);
            }));
        }

        // --- GAME EVENTS (MOUSE/TOUCH) ---
        function getPos(e) {
            const r = canvas.getBoundingClientRect();
            const x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
            return { x: (x-r.left)*(canvas.width/r.width), y: (y-r.top)*(canvas.height/r.height) };
        }

        function handleStart(e) {
            e.preventDefault(); const pos = getPos(e);
            for(let i=pieces.length-1; i>=0; i--) {
                const p = pieces[i];
                if(pos.x>=p.x-10 && pos.x<=p.x+p.w+10 && pos.y>=p.y-10 && pos.y<=p.y+p.h+10) {
                    dragging = p; dragging.dx = pos.x - p.x; dragging.dy = pos.y - p.y;
                    draw(); return;
                }
            }
        }
        function handleMove(e) {
            if(!dragging) return;
            e.preventDefault(); const pos = getPos(e);
            dragging.x = pos.x - dragging.dx; dragging.y = pos.y - dragging.dy;
            draw();
        }
        function handleEnd(e) {
            if(!dragging) return;
            e.preventDefault();
            const gx = Math.round((dragging.x-10)/CELL_SIZE);
            const gy = Math.round((dragging.y-10)/CELL_SIZE);
            
            if(canPlace(dragging.m, gx, gy)) {
                place(dragging.m, gx, gy);
                pieces = pieces.filter(p => p !== dragging);
                if(pieces.length === 0) spawnPieces();
            } else {
                dragging.x = dragging.bx; dragging.y = dragging.by;
            }
            dragging = null; draw();
        }

        function canPlace(m, gx, gy) {
            return m.every((row, r) => row.every((val, c) => {
                if(!val) return true;
                const tx = gx+c, ty = gy+r;
                return tx>=0 && tx<GRID_SIZE && ty>=0 && ty<GRID_SIZE && !grid[ty][tx];
            }));
        }

        function place(m, gx, gy) {
            m.forEach((row, r) => row.forEach((val, c) => { if(val) grid[gy+r][gx+c] = 1; }));
            blockScore += 10;
            // SatÄ±r/SÃ¼tun silme
            let rows=[], cols=[];
            for(let r=0; r<GRID_SIZE; r++) if(grid[r].every(v=>v)) rows.push(r);
            for(let c=0; c<GRID_SIZE; c++) if(grid.map(r=>r[c]).every(v=>v)) cols.push(c);
            
            if(rows.length + cols.length > 0) {
                rows.forEach(r => grid[r].fill(0));
                cols.forEach(c => grid.forEach(r => r[c]=0));
                const bonus = (rows.length+cols.length) * 50;
                playerCash += bonus;
                updateEconomy();
            }
            document.getElementById('score').innerText = "$" + blockScore;
        }

        canvas.addEventListener('mousedown', handleStart); canvas.addEventListener('touchstart', handleStart, {passive:false});
        canvas.addEventListener('mousemove', handleMove); canvas.addEventListener('touchmove', handleMove, {passive:false});
        canvas.addEventListener('mouseup', handleEnd); canvas.addEventListener('touchend', handleEnd, {passive:false});
        
        // --- BAÅžLAT ---
        window.onload = function() {
            lucide.createIcons();
            loadScenarios();
            initGame();
            updateEconomy();
            window.addEventListener('resize', resizeBlockGame);
        };

    </script>
</body>
</html>
